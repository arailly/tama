{% extends "base.html" %}
{% block content %}
    <div class="container">
    <canvas id="canvas" width="1600" height="1000"></canvas>
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // draw passage
        const passages = {{ passage|tojson }}

        ctx.lineWidth = 10

        const shift = 50;
        const power = 80;

        const x_min = Object.keys(passages).reduce(
            (acc, cur) => {
                const passage = passages[cur];
                return Math.min(acc, passage.xbegin, passage.xend)
            }, Infinity
        );

        const y_max = Object.keys(passages).reduce(
            (acc, cur) => {
                const passage = passages[cur];
                return Math.max(acc, passage.ybegin, passage.yend)
            }, -Infinity
        );

        Object.keys(passages).forEach((i) => {
            const passage = passages[i];

            // begin
            ctx.moveTo(
                shift + (-x_min + passage.xbegin) * power,
                shift + (y_max + -passage.ybegin) * power
            );

            // end
            ctx.lineTo(
                shift + (-x_min + passage.xend) * power,
                shift + (y_max + -passage.yend) * power
            )
        })

        // draw trajectory
        const trajectory = {{ trajectory|tojson }};
        console.log(trajectory)

        ctx.stroke();
    })
    </script>
    </div>
{% endblock %}