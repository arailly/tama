{% extends "base.html" %}
{% block content %}
    <div class="container">
    <canvas id="canvas" width="1600" height="1000"></canvas>
    <script>
    const generate_converter = (x_min, y_max, power, shift) => {
        return (x, y) => [
            shift + (-x_min + x) * power,
            shift + (y_max - y) * power
        ]
    };

    document.addEventListener('DOMContentLoaded', () => {
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        // draw passage
        const passages = {{ passage|tojson }}

        ctx.lineWidth = 10

        const shift = 50;
        const power = 50;

        const x_min = Object.keys(passages).reduce(
            (acc, cur) => {
                const passage = passages[cur];
                return Math.min(acc, passage.xbegin, passage.xend)
            }, Infinity
        );

        const y_max = Object.keys(passages).reduce(
            (acc, cur) => {
                const passage = passages[cur];
                return Math.max(acc, passage.ybegin, passage.yend)
            }, -Infinity
        );

        console.log(x_min, y_max);

        const convert = generate_converter(x_min, y_max, power, shift);

        ctx.strokeStyle = "#242424";

        Object.keys(passages).forEach((key) => {
            const passage = passages[key];

            // begin
            ctx.moveTo(...convert(passage.xbegin, passage.ybegin));

            // end
            ctx.lineTo(...convert(passage.xend, passage.yend));

        })

        ctx.stroke();

        // draw trajectory
        ctx.strokeStyle = "#3298dc";

        const trajectory = {{ trajectory|tojson }};
        Object.keys(trajectory).forEach((key) => {
            const cur_trajectory = trajectory[key];
            ctx.beginPath();
            ctx.arc(
                ...convert(cur_trajectory.x, cur_trajectory.y),
                3, 0, 2 * Math.PI
            );
            ctx.stroke();
        });

        // draw modified trajectory
        ctx.strokeStyle = "orange";

        const modified = {{ modified|tojson }};
        Object.keys(modified).forEach((key) => {
            const cur_trajectory = modified[key];
            ctx.beginPath();
            ctx.arc(
                ...convert(cur_trajectory[0], cur_trajectory[1]),
                3, 0, 2 * Math.PI
            );
            ctx.stroke();
        });
    });
    </script>
    </div>
{% endblock %}